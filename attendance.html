<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AfricaSpani Attendance System</title>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<!-- jsPDF AutoTable (FOR EXACT TABLE) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>

<style>
  body { background:#e0f2fe; }
  input, select {
    color: black !important;
    background: white !important;
    border: 2px solid #333 !important;
  }
  .locked { opacity:0.4; pointer-events:none; }
</style>
</head>

<body class="min-h-screen p-6">

<!-- HEADER -->
<div class="mb-6 flex items-center gap-3">
  <i class="fa-solid fa-database text-3xl text-sky-600"></i>
  <div>
    <h1 class="text-3xl font-bold text-gray-800">AfricaSpani Attendance Database</h1>
    <p id="dateTime" class="text-gray-700"></p>
  </div>
</div>

<!-- COMPANY DETAILS -->
<div id="companySection" class="bg-[#010a1f] p-6 rounded-lg shadow-lg max-w-5xl mx-auto text-white mb-6">
  <h2 class="text-xl font-bold mb-4">Company Details</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <input id="companyName" placeholder="Company Name" class="p-2 rounded"/>
    <input id="capacity" type="number" min="1" placeholder="Capacity" class="p-2 rounded"/>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mt-4">
    <select id="authority" class="p-2 rounded">
      <option value="">Authority</option>
      <option>Data Security Engineer</option>
      <option>Data Admin Technologist</option>
    </select>

    <select id="timeType" class="p-2 rounded">
      <option value="">Time Type</option>
      <option>TIME IN</option>
      <option>TIME OUT</option>
    </select>

    <select id="companyType" class="p-2 rounded">
      <option value="">Company Type</option>
      <option>PRIVATE LIMITED</option>
      <option>CLOSE COOPERATIVE</option>
      <option>PARTNERSHIP</option>
      <option>OTHER</option>
    </select>

    <button id="startCapture" class="bg-blue-600 hover:bg-blue-700 py-2 rounded font-semibold">
      Start Capture
    </button>
  </div>
</div>

<!-- EMPLOYEE DETAILS -->
<div id="employeeSection" class="bg-[#010a1f] p-6 rounded-lg shadow-lg max-w-5xl mx-auto text-white mb-6 locked">
  <h2 class="text-xl font-bold mb-4">Employee Details</h2>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <input id="initials" placeholder="Initials & Surname" class="p-2 rounded"/>
    <input id="jobTitle" placeholder="Job Title" class="p-2 rounded"/>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
    <input id="faceID" placeholder="Face ID" disabled class="p-2 rounded"/>
    <input id="biometricID" placeholder="Biometric ID" disabled class="p-2 rounded"/>
  </div>

  <div class="mt-4 flex gap-4 items-center">
    <button id="verifyBtn" class="bg-sky-600 hover:bg-sky-700 px-4 py-2 rounded font-semibold">
      <i class="fa-solid fa-fingerprint"></i> Verify
    </button>
    <span id="countdown" class="font-bold text-yellow-300"></span>
  </div>

  <button id="saveData" class="mt-4 bg-green-600 hover:bg-green-700 px-4 py-2 rounded font-semibold">
    Save Data
  </button>
</div>

<!-- TABLE -->
<div class="bg-white p-6 rounded-lg shadow-lg max-w-6xl mx-auto">
  <table class="w-full border text-sm">
    <thead class="bg-sky-500 text-white">
      <tr>
        <th class="p-2">Initials</th>
        <th class="p-2">Job</th>
        <th class="p-2">Face ID</th>
        <th class="p-2">Biometric ID</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>

  <div class="mt-6">
    <button id="printReceipt" class="bg-gray-900 text-white px-6 py-2 rounded font-semibold hidden w-full">
      Download PDF Receipt
    </button>
  </div>
</div>

<script>
/* CLOCK */
setInterval(() => {
  dateTime.textContent = new Date().toLocaleString();
}, 1000);

/* STATE */
let records = [];
let capacityLimit = 0;
let bioCounter = 1;
let faceCounter = 1001;

/* START CAPTURE */
startCapture.onclick = () => {
  if (!companyName.value || !capacity.value || !authority.value || !timeType.value || !companyType.value) {
    alert("Complete company details");
    return;
  }
  capacityLimit = Number(capacity.value);
  companySection.classList.add("locked");
  employeeSection.classList.remove("locked");
};

/* VERIFICATION – 25 SECONDS */
verifyBtn.onclick = () => {
  verifyBtn.disabled = true;
  let t = 25;
  countdown.textContent = `Verifying... ${t}s`;

  const timer = setInterval(() => {
    t--;
    countdown.textContent = `Verifying... ${t}s`;

    if (t <= 0) {
      clearInterval(timer);
      const m = new Date().getMonth() + 1;
      faceID.value = `26/${m}/${faceCounter++}`;
      biometricID.value = `26/${m}/${String(bioCounter++).padStart(3,"0")}`;
      countdown.textContent = "✔ Verification Approved";
      verifyBtn.disabled = false;
    }
  }, 1000);
};

/* SAVE DATA */
saveData.onclick = () => {
  if (records.length >= capacityLimit) return alert("Capacity reached");
  if (!faceID.value) return alert("Verify first");

  const record = {
    initials: initials.value,
    job: jobTitle.value,
    face: faceID.value,
    bio: biometricID.value
  };

  records.push(record);

  tableBody.innerHTML += `
    <tr class="border-b text-center">
      <td class="p-2">${record.initials}</td>
      <td class="p-2">${record.job}</td>
      <td class="p-2">${record.face}</td>
      <td class="p-2">${record.bio}</td>
    </tr>
  `;

  initials.value = jobTitle.value = faceID.value = biometricID.value = "";
  countdown.textContent = "";

  if (records.length >= capacityLimit) {
    printReceipt.classList.remove("hidden");
  }
};

/* PDF DOWNLOAD – EXACT TABLE */
printReceipt.onclick = () => {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p","mm","a4");

  pdf.setFontSize(16);
  pdf.text("AfricaSpani Database", 105, 15, { align: "center" });
  pdf.setFontSize(12);
  pdf.text("Digital Attendance List", 105, 22, { align: "center" });

  pdf.setFont("courier","normal");
  pdf.setFontSize(10);

  pdf.text(`Company: ${companyName.value}`, 14, 35);
  pdf.text(`Authority: ${authority.value}`, 14, 41);
  pdf.text(`Company Type: ${companyType.value}`, 14, 47);
  pdf.text(`Time Type: ${timeType.value}`, 14, 53);
  pdf.text(`Capacity: ${capacityLimit}`, 14, 59);

  pdf.autoTable({
    startY: 70,
    head: [["Initials", "Job Title", "Face ID", "Biometric ID"]],
    body: records.map(r => [r.initials, r.job, r.face, r.bio]),
    styles: { fontSize: 9 },
    headStyles: { fillColor: [14, 165, 233] }
  });

  pdf.save("AfricaSpani_Digital_Attendance.pdf");
};
</script>

</body>
</html>
